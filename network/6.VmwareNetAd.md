##VMware 网络模型

###搬运地址
  1. ["VM三种网络模式"](https://blog.csdn.net/dengjin20104042056/article/details/95023540)
  2. ["VM网络模型详解"](https://www.cnblogs.com/bakari/p/10592421.html)

###四种常见网络模型
  总的来说，目前有四种常见的网络模型：
  - 桥接（Bridge Adapter）
  - NAT
  - 主机（Host-only Adapter）
  - 内部网络（Internal）
这也是 VirtualBox 支持的四种模型，对于 VMware，则只有前三种。
下图显示了 VirtualBox 支持的几种网络模型：
!["VirtualBox网络模型"](/images/networks/VMwareNetAd/virtualBox网络模型.png)


###1.桥接（Bridge Adapter）
虚拟机桥接网络模型就是使用虚拟交换机（Linux Bridge），将虚拟机和物理机连接起来，它们处于同一个网段，IP 地址是一样的。如下图所示：
  !["桥接模式"](/images/networks/VMwareNetAd/桥接模式.png)

>在这种模式下，VMWare虚拟出来的操作系统就像是局域网中的一台独立的主机，它可以访问网内任何一台机器。

>在桥接模式下，你需要手工为虚拟系统配置IP地址、子网掩码，而且还要和宿主机器处于同一网段，这样虚拟系统才能和宿主机器进行通信。
>同时，由于这个虚拟系统是局域网中的一个独立的主机系统，那么就可以手工配置它的TCP/IP配置信息，以实现通过局域网的网关或路由器访问互联网。如下图所示：

  !["桥接模式详解"](/images/networks/VMwareNetAd/桥接模式详解.png)

>使用桥接模式的虚拟系统和宿主机器的关系，就像连接在同一个Hub上的两台电脑。想让它们相互通讯，你就需要为虚拟系统配置IP地址和子网掩码，否则就无法通信。

在这种网络模型下，虚拟机和物理机都处在一个二层网络里面，所以有：
  - 虚拟机之间彼此互通
  - 虚拟机与主机彼此可以互通
  - >桥接网络的好处是简单方便，但也有一个很明显的问题，就是一旦虚拟机太多，广播就会很严重。所以，桥接网络一般也只适用于桌面虚拟机或者小规模网络这种简单的形式。


###2. NAT (Network Address Translation)即网络地址转换

桥接模式配置简单，但如果网络环境是ip资源很缺少或对ip管理比较严格，那桥接模式就不太适用

####NAT

NAT模式借助虚拟NAT设备和虚拟DHCP服务器，使得虚拟机可以联网。其网络结构如下图所示：

  !["NAT模式详解"](/images/networks/VMwareNetAd/NAT模式详解.png)

>在NAT模式中，主机网卡直接与虚拟NAT设备相连，然后虚拟NAT设备与虚拟DHCP服务器一起连接在虚拟交换机VMnet8上，这样就实现了虚拟机联网。

####NAT 与NAT 网络

  这种模型严格来讲，又可以分为 NAT 和 NAT 网络两种，我们看上面的图 1 也可以看到。
根据 NAT 的原理，虚拟机所在的网络和物理机所在的网络不在同一个网段，虚拟机要访问物理所在网络必须经过一个地址转换的过程，也就是说在虚拟机网络内部需要内置一个虚拟的 NAT 设备来做这件事。

但其中 NAT 和 NAT 网络 两者还有些许的不同：
  - NAT：主机上的虚拟机之间是互相隔离的，彼此不能通信（它们有独立的网络栈，独立的虚拟 NAT 设备）
  - NAT 网络：虚拟机之间共享虚拟 NAT 设备，彼此互通。

如下图，展示了两者细微的差别：
  !["NAT和NAT网络"](/images/networks/VMwareNetAd/NAT和NAT网络.png)
  > NAT 网络模式中一般还会内置一个虚拟的 DHCP 服务器来进行 IP 地址的管理。

通过实验来验证一下两种模式的区别，首先是 NAT 模式：
  !["NAT模式验证1"](/images/networks/VMwareNetAd/NAT模式验证1.png)

访问其他虚拟机：
  !["NAT模式验证2"](/images/networks/VMwareNetAd/NAT模式验证2.png)
>可以看到，两个虚拟机由于有隔离的网络栈，所以它们的 IP 地址并不在一个网段，所以 ping 不通。

再看 **NAT** 网络，访问外网同样没问题，看下 **VM** 之间的互通：
  !["NAT模式验证3"](/images/networks/VMwareNetAd/NAT模式验证3.png)
>可以看到，差别体现出来了，NAT 网络 虚拟机之间共享网络栈，它们的 IP 地址处于同一个网段，所以彼此是互通的。

总结一下，以上两种 NAT 模式，如果不做其他配置，那么有：
  - 虚拟机可以访问主机，反之不行
  - 如果主机可以上外网，那么虚拟机也可以
  - 对于 NAT，同主机上的虚拟机之间不能互通
  - 对于 NAT 网络，虚拟机之间可以互通

>PS：如果做了 **端口映射** 配置，那么主机也可以访问虚拟机。

###3. 主机网络（Host-only Adapter）

主机网络顾名思义，就是只限于主机内部访问的网络，虚拟机之间彼此互通，虚拟机与主机之间彼此互通。但是默认情况下虚拟机不能访问外网（注意：这里说的是默认情况下，如果稍作配置，也是可以的）。

主机网络看似简单，其实它的网络模型是相对比较复杂的，可以说前面几种模式实现的功能，在这种模式下，都可以通过虚拟机和网卡的配置来实现，这得益于它特殊的网络模型。

主机网络模型会在主机中模拟出一块虚拟网卡供虚拟机使用，所有虚拟机都连接到这块网卡上，这块网卡默认会使用网段 192.168.56.x（在主机的网络配置界面可以看到这块网卡），如下是基本的拓扑图示：
  !["主机网络模型"](/images/networks/VMwareNetAd/主机网络模型.png)

默认情况下，虚拟机之间可以互通，虚拟机只能和主机上的虚拟网卡互通，不能和不同网段的网卡互通，更不能访问外网，如果想要访问外网，那么需要如图中 **红虚线** 所示，将物理网卡和虚拟网卡桥接或共享。在主机上做如下设置即可：
  !["主机网络设置"](/images/networks/VMwareNetAd/主机网络设置.png)

通过以上配置，我们来验证一下，虚拟机可以访问主机物理网卡和外网：
  !["主机网络验证1"](/images/networks/VMwareNetAd/主机网络验证1.png)

###4. 内部网络（internal）

>最后一种网络模型是内部网络，这种模型是相对最简单的一种，虚拟机与外部环境完全断开，只允许虚拟机之间互相访问。
>这种模型一般不怎么用，所以仅在virtualBox中有，VMware 虚拟机中没有这种网络模式。

###5. 总结

虚拟机的四种网络模型：桥接、NAT、主机和内网模型。

下面以一张表来描述它们之间的通信行为：
  !["主机网络验证1"](/images/networks/VMwareNetAd/主机网络验证1.png)
| Model|	VM -> host|	host -> VM |	VM <-> VM	|VM -> Internet|	Internet -> VM|
|:----:|:----:|:----:|:----:|:----:|:----:|:----:|
|Bridged	    |+	 | +	              |+	 | +	  |  +|
|NAT	        |+	 | Port Forwarding	|-	 | +	  |  Port Forwarding|
|NAT Network	|+	 | Port Forwarding	|+	 | +	  |  Port Forwarding|
|Host-only	  |+	 | +               |+	 | -   |  -|
|Internal	    |-	 | -               |+	 | -   |  -|
